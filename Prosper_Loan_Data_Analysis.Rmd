---
title: 'Prosper Loan Data Analysis'
author: 'Tarun Lingam'
output: 
  html_document:
    fig_height: 6
    fig_width: 8
    highlight: tango
    theme: united
    toc: yes
    toc_depth: 2
    toc_float: yes
editor_options: 
  chunk_output_type: console
---
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(knitr)
library(ggplot2)
library(dplyr)
library(GGally)
library(gridExtra)
library(lemon)
library(RColorBrewer)
library(maps)
library(mapproj)
library(reshape2)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
data <- read.csv('prosperLoanData.csv')
```

# Introduction {#Intro}
***

Prosper or Prosper Marketplace, is a leader in the online peer-to-peer lending industry. Borrowers create profiles and listings (request loans) on [Prosper.com](https://www.prosper.com). Borrowers can apply for a fixed-rate - fixed-term loan between $2,000 and $40,000. Investors, either individuals or institutions, view the listing (borrower’s loan request) and decide how much to lend the borrower towards the loan.  

Interest rates are typically lower for the borrower than going to a financial institution, such as a bank and multiple investors can contribute to one borrower’s loan request, limiting the overall risk impact of the borrower defaulting on the loan for any one investor and providing a higher yield.  

As an amateur, I find the idea of peer-to-peer lending quite interesting from a borrower and an investor standpoint. Through this analysis, I would like to determine which conditions(variables) might determine Loan repayment of users.

# Data Overview {#Overview}
***

The [Prosper Loan dataset](https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0) contains 113,937 loans with 81 variables on each loan, including loan amount, borrower rate (or interest rate), current loan status, borrower income, borrower employment status, borrower credit history, and the latest payment information.  
The dataset was last updated on 03/11/2014.

## Structure of the dataset {#Structure}
***

The dimensions of the dataset and list of all the variables are as follows:
```{r echo=FALSE, message=FALSE, warning=FALSE, dataset_structure}
#Dimensions of the dataset
dim(data)
#Features in the dataset
names(data)
```

***

# Feature Selection {#Feature_Selection}
***

As it is not efficient to use all 81 variables for my analysis, the variables I picked for my analysis are:

- **Term** --- The length of the loan expressed in months.  
- **ListingCategory** --- The category of the listing that the borrower selected when posting their listing:
    - 0 - Not Available
    - 1 - Debt Consolidation
    - 2 - Home Improvement
    - 3 - Business
    - 4 - Personal Loan
    - 5 - Student Use
    - 6 - Auto
    - 7 - Other 
    - 8 - Baby&Adoption
    - 9 - Boat
    - 10 - Cosmetic Procedure
    - 11 - Engagement Ring
    - 12 - Green Loans
    - 13 - Household Expenses
    - 14 - Large Purchases
    - 15 - Medical/Dental
    - 16 - Motorcycle
    - 17 - RV
    - 18 - Taxes
    - 19 - Vacation
    - 20 - Wedding Loans  
- **LoanStatus** --- The current status of the loan:
    - Cancelled
    - Chargedoff
    - Completed
    - Current
    - Defaulted
    - FinalPaymentInProgress
    - PastDue. The PastDue status will be accompanied by a delinquency bucket.  
- **LoanOriginalAmount** --- The origination amount of the loan.  
- **EmploymentStatus** --- The employment status of the borrower at the time they posted the listing.  
- **EmploymentStatusDuration** --- The length in months of the employment status at the time the listing was created.  
- **IncomeRange** --- The income range of the borrower at the time the listing was created.  
- **IncomeVerifiable** --- The borrower indicated they have the required documentation to support their income.  
- **CreditScoreRangeLower** --- The lower value representing the range of the borrower's credit score as provided by a consumer credit rating agency.  
- **CreditScoreRangeUpper** --- The upper value representing the range of the borrower's credit score as provided by a consumer credit rating agency.  
- **DebtToIncomeRatio** --- The debt to income ratio of the borrower at the time the credit profile was pulled. This value is Null if the debt to income ratio is not available. This value is capped at 10.01 (any debt to income ratio larger than 1000% will be returned as 1001%).   
- **BorrowerAPR** --- The Borrower's Annual Percentage Rate (APR) for the loan.  
- **IsBorrowerHomeowner** --- A Borrower will be classified as a homeowner if they have a mortgage on their credit profile or provide documentation confirming they are a homeowner.  
- **ProsperScore** --- A custom risk score built using historical Prosper data. The score ranges from 1-10, with 10 being the best, or lowest risk score.  Applicable for loans originated after July 2009.    
- **ProsperRating..Alpha** --- The Prosper Rating assigned at the time the listing was created between AA - HR.  Applicable for loans originated after July 2009.  
- **BorrowerState** --- The number of days delinquent.  

***

# Univariate Analysis {#Univariate}
***

To get an idea of the various variables and their relationships with each other and to the output variable, I will be conducting univariate analysis by plotting bar charts and histograms.  
At the end of the univariate analysis I will have a better idea about the variables to use in the bivariate and multivariate analysis.

***

I will subset a dataframe with only the selected variables.
```{r echo=FALSE, message=FALSE, warning=FALSE, Subset_Dataframe}
#Selected features from the dataset
selected <- c('Term', 'ListingCategory..numeric.',
              'LoanStatus', 'LoanOriginalAmount',
              'EmploymentStatus', 'EmploymentStatusDuration',
              'IncomeRange', 'IncomeVerifiable',
              'BorrowerAPR', 'BorrowerState',
              'CreditScoreRangeLower', 'CreditScoreRangeUpper',
              'IsBorrowerHomeowner', 'DebtToIncomeRatio',
              'ProsperScore', 'ProsperRating..Alpha.')
#Subset the dataset with the selected features
loan <- subset(data, select = selected)
#Structure of the subset data
str(loan)
```

***

## LoanStatus Analysis {#LoanStatus_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, loan_status_plot}
# Create a variable which contains all the Past Due categories. 
# They will be aggregated into one category called "Delinquent"

Delinquent <- c('Past Due (>120 days)', 'Past Due (1-15 days)', 
              'Past Due (16-30 days)', 'Past Due (31-60 days)', 
              'Past Due (61-90 days)', 'Past Due (91-120 days)')

# Add the new factor level 

loan$LoanStatus <- factor(loan$LoanStatus, 
                    levels = c(levels(loan$LoanStatus), "Delinquent"))

# Set all categories contained in Delinquent to 'Delinquent'

loan[loan$LoanStatus %in% Delinquent, 'LoanStatus'] <- c('Delinquent')

# Aggregate "FinalPaymentInProgress" with Completed
# Create a variable with all categories that will be set to be "Completed" 
complete <- c('Completed', 'FinalPaymentInProgress')

# Set all categories contained in complete to 'Completed'
loan[loan$LoanStatus %in% complete, 'LoanStatus'] <- c('Completed')

# Remove the factors that were aggregated. Order the levels.
loan$LoanStatus <- factor(loan$LoanStatus, 
                    levels = c("Completed", "Current", "Delinquent", 
                               "Defaulted", "Chargedoff", "Cancelled"))
#Plot Loan Status
ggplot(aes(LoanStatus), data = loan) +
  geom_bar(aes(y = ..count..)) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Status Plot') +
  geom_text(stat='count', aes(label=..count..), vjust = -0.2) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 9, color = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))

```

- From this plot, it can be seen that the highest number of borrowers have *Current* loans, followed by *Completed* loans.   
- I aggregated all the past due categories into the *Delinquent* category.    

> [Delinquent](https://www.investopedia.com/terms/d/delinquent.asp) describes something or someone that fails to accomplish what is required by law or duty, such as the failure to make a required payment or perform a certain action. In a financial sense, delinquency occurs as soon as a borrower misses a payment.  

> [Defaulted](https://en.wikipedia.org/wiki/Default_(finance)) is failure to meet the legal obligations (or conditions) of a loan. It occurs when a borrower fails to repay the loan as specified in the original contract. Most creditors allow a loan to remain delinquent for a period of time before considering it as default; the duration depends on the creditor and loan type.

> A [Chargedoff](https://www.investopedia.com/terms/c/chargeoff.asp) loan is deemed unlikely to be collected by the creditor because the borrower has become substantially delinquent after a period of time. Traditionally, creditors will make this declaration at the point of six months without payment.  


***

## Create a new column to categorize borrowers based on LoanStanding {#LoanStanding_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, new_variable}
#Create new column - LoanStanding.
#Define Good and Bad LoanStanding using ifelse
loan$LoanStanding <- ifelse(loan$LoanStatus == "Delinquent" |
                          loan$LoanStatus == "Defaulted" |
                          loan$LoanStatus == "Chargedoff", 
                          'Bad','Good')
#Convert into factor variable
loan$LoanStanding <- factor(loan$LoanStanding)

#Plot LoanStanding
ggplot(aes(LoanStanding, fill = LoanStanding), data = loan) +
  geom_bar(width = 0.4) +
  geom_text(stat = 'count', aes(label = ..count..), size = 3.2, vjust = -0.4) +
  ylab('Number of Borrowers') +
  ggtitle('Borrowers by Loan Standing') +
  scale_fill_manual(values = c("firebrick2", "springgreen3")) +
  theme_minimal() +
  theme(axis.text.x = element_text(face = 'italic', size = 12, color = 'grey0')) +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        plot.title = element_text(family = 'Times', hjust = 0.5, face = 'bold.italic', color = 'black'))
```

- Categorizing the borrowers into 'Bad' and 'Good' standing in a new variable based on their loan status.  
- The borrowers with 'Completed' and 'Current' and 'Cancelled' loans are categorized into *Good*.  
  - I'm considering 'Cancelled' loans to be loan forgiveness which falls into 'Good' category.
- The borrowers with 'Delinquent', 'Defaulted' and 'Chargedoff' loans are categorized into *Bad*.  

***

## Loan Term Analysis {#LoanTerm_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, Term_plot}
#Covert to Factor
loan$Term <- factor(loan$Term, ordered = T)
#Display Summary by LoanStanding
by(loan$LoanStanding, loan$Term, summary)
#Plot 
ggplot(aes(Term, fill = LoanStanding), data = loan) +
  geom_bar(width = 0.6) +
  xlab('Term(in months)') +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Loan Term') +
  theme_minimal() +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'),
        axis.text.x = element_text(size = 10, color = 'grey0', face = 'italic'))
```

- From the plot, it can be observed that the loan terms are divided into 12, 36 & 60 month periods.
- The 36 month loan term is the most popular with 87778 borrowers opting for it.
- The 12 month loan term is the least popular with only 1614 borrowers opting for it.
- The proportion of borrowers with bad standing is 5.7%, 19.4% and 7.9% for 12, 24 & 36 month term loans.

***

## ListingCategory Analysis {#ListingCategory_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, ListingCategory_plot}
# Create vector with category names
listing_category <- c("Not Available", "Debt Consolidation", "Home Improvement", 
                      "Business", "Personal Loan", "Student Use", "Auto", "Other", 
                      "Baby&Adoption", "Boat", "Cosmetic Procedure", 
                      "Engagement Ring", "Green Loans","Household Expenses", 
                      "Large Purchases", "Medical/Dental", "Motorcycle",
                      "RV", "Taxes", "Vacation", "Wedding Loans")

# Create new variable with category names (index of the vector starts at 1)
loan$ListingCategoryName <- listing_category[(loan$ListingCategory..numeric.)+1]
#Convert to factor
loan$ListingCategoryName <- factor(loan$ListingCategoryName)
#Plot
ggplot(aes(ListingCategoryName, fill = ListingCategoryName), data = loan) +
  geom_bar(position = 'dodge') +
  ylab('Number of Borrowers') +
  ggtitle('Listing Category Plot') +
  theme_minimal() +
  geom_text(aes(label = ..count..), stat = 'count', size = 2.5, vjust = -0.4, color = 'tomato4') +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.9, size = 8, colour = 'grey0'), legend.position = 'none',
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))
  
```

## {#ListingCategory_LoanStanding_plot}
```{r echo=FALSE, message=FALSE, warning=FALSE, ListingCategory_LoanStanding_plot}
#Plot
ggplot(aes(ListingCategoryName, fill = LoanStanding), data = loan) +
  geom_bar(position = 'dodge') +
  scale_y_log10() +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Listing Category') +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.9, size = 8, color = 'grey0')) +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        plot.title = element_text(family = 'Times', hjust = 0.5, face = 'bold.italic', color = 'black'))

```


- Listing category represents the reason why a borrower is requesting a loan.
- The above plot shows that the majority of loans are under the category 'Debt Consolidation'.
- One thing to remember is that 'Debt Consolidation' is a vague term, as the debt could be due to any of the other listing categories. For example debt due to a car purchase, wedding purchases, etc. Many borrowers may have debt from multiple sources. 
- I scaled the y axis with a log10 transformation to view the data distribution better.
- The scaled plot shows that the "Boat and "RV" ListingCategories have the least proportion of borrowers with Bad Standing Loans.

***

## LoanOriginalAmount Analysis {#LoanOriginalAmount_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, LoanOriginalAmount_plot}
# Summary of LoanOriginalAmount
summary(loan$LoanOriginalAmount)
#Plot
ggplot(aes(LoanOriginalAmount), data = loan) +
  geom_histogram(binwidth = 500) +
  ylab('Number of Borrowers') +
  ggtitle('Original Loan Amount Plot') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, face = 'bold.italic', family = 'Times', color = 'black'),
        axis.text.x = element_text(size = 9, color = 'grey0') )
```

- The summary shows a range of $1000 to $35000.
- The mean($8337) and median($6500) are considerably apart. This is shown in the plot.
- There are significant spikes at around $4000, $10000, $15000, $20000 and $25000.
- These spikes at higher loan amounts drag the mean higher.

## {#LoanOriginalAmount_LoanStanding_plot}
```{r echo=FALSE, message=FALSE, warning=FALSE, LoanOriginalAmount_LoanStanding_plot}
# Summary of LoanOriginalAmount by LoanRisk
by(loan$LoanOriginalAmount, loan$LoanStanding, summary)
#Plot
ggplot(aes(LoanOriginalAmount, fill = LoanStanding), data = loan) +
  geom_area(stat = 'bin', binwidth = 250) +
  coord_cartesian(xlim = c(1000, quantile(loan$LoanOriginalAmount, 0.90))) + 
  scale_x_continuous(breaks = seq(0, 15000, 2500)) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Original Loan Amount') +
  theme_minimal() +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        axis.text.x = element_text(size = 9, color = 'grey0'), 
        plot.title = element_text(family = 'Times', face = 'bold.italic', hjust = 0.5, color = 'black'))
```

- Focusing the plot to 90% of the data, it can be seen that maximum number of loan amounts are rounded.
- For example, there are spikes at about $500 intervals, with significant spikes at $1000 intervals.
- This makes sense as most borrowers would quote numbers rounded to the nearest $500 or $1000 rather than the exact required amount. This also makes it easy for the investors.
- From the plot, the proportion of Bad Loan Standing borrowers seems to reduce as the loan amount increases. This can happen due to higher loan amounts being approved for borrowers with good history, like credit score, etc. This relationship can be investigated later.

***

## EmploymentStatus Analysis {#EmploymentStatus_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, EmploymentStatus_plot}
#Plot 1
ggplot(aes(EmploymentStatus), data = loan) +
  geom_bar(position = 'dodge') +
  geom_text(stat = 'count', aes(label = ..count..), size = 3, vjust = -0.4) +
  ylab('Number of Borrowers') +
  ggtitle('Employement Status Plot') +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.7, color = 'grey0', size = 9),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
```

### {#EmploymentStatus_LoanStanding_plot}
```{r echo=FALSE, warning=FALSE, message=FALSE, EmploymentStatus_LoanStanding_plot}
#Plot 2
ggplot(aes(EmploymentStatus, fill = LoanStanding), data = loan) +
  geom_bar(position = 'dodge') +
  geom_text(stat = 'count', aes(label = ..count..),
            position = position_dodge(width = 1), size = 3,vjust = -0.4, check_overlap = T) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Employement Status') +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.7, color = 'grey0', size = 9)) +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
```

- The categorization in the variable is vague. For example, 'Part-time', 'Full-Time', Self-employed' come under 'Employed'.
- There is a category for borrowers who have not given employment details.
- Markedly high number of borrowers are employed.
- Significantly higher number of employed borrowers with good loan standing.

***

## Employment Duration Analysis {#EmploymentDuration_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, EmploymentStatusDuration_plot}
# Set all durations for those not employed to be 0.
loan$EmploymentStatusDuration <- ifelse(loan$EmploymentStatus == 'Not employed',
                                        0*loan$EmploymentStatusDuration,
                                        loan$EmploymentStatusDuration)

# Now, set employment condition
condition <- c("Employed", "Part-time", "Full-time", "Not employed", "Self-employed")

#Plot 1
p1 <- ggplot(subset(loan, EmploymentStatus %in% condition & !is.na(EmploymentStatusDuration)), 
             aes(EmploymentStatusDuration)) + 
  geom_histogram(binwidth = 12) +
  ggtitle('Employement Duration Plot') +
  ylab('Number of Borrowers') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'),
        axis.title.x = element_blank())

#Plot 2
p2 <- ggplot(subset(loan, EmploymentStatus %in% condition & !is.na(EmploymentStatusDuration)), 
             aes(EmploymentStatusDuration, fill = LoanStanding)) + 
  geom_histogram(binwidth = 12) +
  coord_cartesian(xlim = c(0,400)) +
  ylab('Number of Borrowers') +
  theme_minimal() +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        axis.title.x = element_blank())

#Plot 3
p3 <- ggplot(subset(loan, EmploymentStatus %in% condition & !is.na(EmploymentStatusDuration)), 
             aes(EmploymentStatusDuration)) + 
  geom_histogram() +
  scale_x_log10() +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 9, color = 'grey0'))

#Create a Plot grid
grid.arrange(p1,p2,p3)
#Summary
summary(subset(loan, EmploymentStatus %in% condition & !is.na(EmploymentStatusDuration))$EmploymentStatusDuration)
```

- I set the EmploymentStatusDuration of all Not employed to 0 and removed NA's. Due to this, the data shows employment duartion rather than employment status duration.
- In the first plot, it is seen that the data is right skewed.
- Focusing on the majority of data in the second plot, it is seen that borrowers with less employment duration are comparitively higher loan risk.
- Doing a log10 transformation in the third plot, the data still looks skewed. Moving forward i will not use this transformation as I cannot gain any new insights.

***

## IncomeRange Analysis {#IncomeRange_LoanStanding_plot}

```{r echo=FALSE, message=FALSE, warning=FALSE, IncomeRange_plot}
# Aggregate 'Not employed' and '$0'
# Set the categories to be aggregated into a variable
zero <- c('$0', 'Not employed')

# Set all the variables in zero to $0
loan[loan$IncomeRange %in% zero, 'IncomeRange'] <- c('$0')

# Order the categories in IncomeRange 
loan$IncomeRange <- factor(loan$IncomeRange, levels = c('$0', '$1-24,999', '$25,000-49,999',
                                                        '$50,000-74,999', '$75,000-99,999',
                                                        '$100,000+'))
#Plot
ggplot(aes(IncomeRange, fill = LoanStanding), data = subset(loan, IncomeVerifiable == 'True' & !is.na(IncomeRange))) +
  geom_bar(width = .7) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Income Range') +
  geom_text(stat = 'count', aes(label = ..count..),
            position = position_stack(vjust = 0.7), check_overlap = TRUE, size = 3) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, size = 9, hjust = 0.9, color = 'grey0')) +
  theme(legend.title = element_text(size = 8), legend.text = element_text(size = 8),
        legend.justification = c(1,1), legend.position = c(1,1),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
```

- The categories in the variable were optimized. 'Not employed' is considered as '$0'. The factors are ordered.
- Looking at the plot, the highest number of borrowers have an income range of '$25,000-49,999' followed by '$50,000-74,999.
- The proportion of borrowers with bad loan standing is highest in the '$1-24,999'.
- The number of borrowers with '$100,000+' income range is relatively very high, which is an interesting find.

***

### Create a new column 'CreditScore'

- Check the difference in CreditScoreRangeUpper and CreditScoreRangeLower for all the borrowers to look for any patterns.

```{r echo=FALSE, message=FALSE, warning=FALSE, CreditScore_difference}
# Check the difference in CreditScoreRangeUpper and CreditScoreRangeLower
CreditScoreDifference <- table(loan$CreditScoreRangeUpper-loan$CreditScoreRangeLower)
CreditScoreDifference
```

- It can be seen that the difference in CreditScoreRangeUpper and CreditScoreRangeLower is constant at 19.
- There are 591 null values.
- Based on the above observation, adding 9.5 to the CreditScoreRangeLower gives the average CreditScore of the borrowers.

```{r echo=FALSE, message=FALSE, warning=FALSE, create_CreditScore}
#Add the average creditscore difference to creditscorerangelower
loan$CreditScore <- loan$CreditScoreRangeLower + 9.5
#Summary
summary(loan$CreditScore)
```

***

## CreditScore Analysis {#CreditScore_LoanStanding_plot}

```{r echo=FALSE, message=FALSE, warning=FALSE, CreditScore_plot}
#Plot
ggplot(aes(CreditScore, fill = LoanStanding), data = subset(loan, !is.na(loan$CreditScore))) +
  geom_bar(width = 15, position = 'dodge') +
  geom_text(stat = 'count', aes(label = ..count..),
            position = position_dodge(width = 15), size = 2.2, vjust = -0.3, check_overlap = T) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Credit Score') +
  coord_cartesian(xlim = c(quantile(loan$CreditScore, 0.01, na.rm = T),
                           quantile(loan$CreditScore, 0.99, na.rm = T))) +
  theme_minimal() +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'),
        axis.text.x = element_text(size = 9, color = 'grey0'))
```

- As there were outliers, I trimmed the lower and upper 1% data.
- It is almost normally distributed. There is a difference of 5.6 between the mean and median. 
- Since the mean is greater than the median it is marginally right skewed. This does not warrant a log transformation.
- An interesting find, is that the sequential difference in CreditScore is 20.
- Looking at the plot, most of the borrowers seem to have CreditScore between 600 and 800.
- The proportion of Bad loan standing borrowers decreases with higher CreditScore.
- The proportion of Bad loan standing borrowers with CreditScore below 600 is very high, over 50%.

***

## DebtToIncomeRatio Analysis {#DebtToIncomeRatio_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, DebtToIncomeRatio_plot}
#Summary
summary(loan$DebtToIncomeRatio)
#Plot
ggplot(aes(DebtToIncomeRatio, fill = LoanStanding), data = subset(loan, !is.na(DebtToIncomeRatio))) +
  geom_area(stat = 'bin',binwidth = 0.005) +
  coord_cartesian(xlim = c(0, quantile(loan$DebtToIncomeRatio, 0.99, na.rm = T))) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Debt to Income Ratio') +
  theme_minimal() +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'),
        axis.text.x = element_text(color = 'gray0', size = 9))
```

- Outliers present which were removed by only considering 99% of the data.
- Data is right skewed. Not significant to perform a log transformation.
- The LoanStanding for borrowers with higher DebtToIncome Ratio seems to be Good. This shows that borrowers with higher income are able to handle more debt and still be successful completing loan payments.  

***

## BorrowerAPR Analysis {#BorrowerAPR_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, BorrowerAPR_plot}
#Summary
summary(loan$BorrowerAPR)
#Plot
ggplot(aes(BorrowerAPR, fill = LoanStanding), data =subset(loan, !is.na(BorrowerAPR))) +
  geom_area(stat = 'bin', binwidth = 0.005) +
  coord_cartesian(xlim = c(0, quantile(loan$DebtToIncomeRatio, 0.90, na.rm = T))) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Borrower APR') +
  theme_minimal() +
  theme(legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1),
        plot.title = element_text(hjust = 0.5, color = 'black', family = 'Times', face = 'bold.italic'),
        axis.text.x = element_text(size = 9, color = 'grey0'))

```

- The data is Right skewed. The mean is greater than the median.
- The mode appears to be around 0.35, which is significantly greater than the mean and median.
- The borrowers with bad LoanStanding have higher APR as expected.
- The right skew of the plot shows that the relation between BorrowerAPR and other variables like CreditScore and DebtToIncomeRatio warrants a deeper look.

***

## IsBorrowerHomeowner Analysis {#IsBorrowerHomeowner_LoanStanding_plot}

```{r echo=FALSE, message=FALSE, warning=FALSE, IsBorrowerHomeowner_plot}
#Plot
ggplot(aes(IsBorrowerHomeowner, fill = LoanStanding), data = loan) +
  geom_bar(width = 0.5) +
  scale_x_discrete(labels = c('No', 'Yes')) +
  geom_text(stat = 'count', aes(label = ..count..),
            position = position_stack(vjust = 0.4)) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Homeowner Status') +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 9, face = 'bold.italic', color = 'grey0'),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'),
        legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1))
```

- There seems to be an insignificant difference in the number of borrowers who own a home and those who do not.
- The proportion of borrowers with Bad LoanStanding seems to be higher in borrowers who do not own a home.

***

## Prosper Score Analysis {#ProsperScore_Univariate}

- Prosper Score for borrowers was introduced after July 2009.  
- ProsperScore data is NA for all borrowers prior to July 2009. By removing NA's, I'll be filtering data prior to July 2009.

```{r echo=FALSE, message=FALSE, warning=FALSE, ProsperScore_plot}
#Convert ProsperScore to factor variable
loan$ProsperScore <- factor(loan$ProsperScore, ordered = T)
#Plot
ggplot(aes(ProsperScore), data = subset(loan, !is.na(ProsperScore))) +
  geom_bar() +
  geom_text(stat = 'count', aes(label = ..count..), vjust = -0.3, size = 3) +
  ylab('Number of Borrowers') +
  ggtitle('Prosper Score Plot') +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 10, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
```

- Looking at the plot, it is evident that most of the borrowers have a ProsperScore from 4 to 8.
- Highest number of borrowers have ProsperScore of 4, followed by 6 & 7.

### {#ProsperScore_LoanStanding_plot}
```{r echo=FALSE, message=FALSE, warning=FALSE, ProsperScore_LoanStanding_plot}
#Plot
ggplot(aes(ProsperScore, fill = LoanStanding), data = subset(loan, !is.na(ProsperScore))) +
  geom_bar(position = 'dodge') +
  geom_text(stat = 'count', aes(label = ..count..),size = 2.5, position = position_dodge(width = 0.9), vjust = -0.6) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Prosper Score') +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 10, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'),
        legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1))
```

- The proportion of Bad LoanStanding borrowers is higher at lower Prosper Score as expected.  

***

## Prosper Rating Analysis {#ProsperRating_Univariate}

- Similar to Prosper Score, Prosper Rating is also only assigned to loans after July 2009.
- A Rating of 'AA' is the best while a rating of 'HR' is the worst.

```{r echo=FALSE, message=FALSE, warning=FALSE, ProsperRating_Plot}
#Change the name of the column to 'ProsperRating'
colnames(loan)[16] <- "ProsperRating"

#Order the factor levels in increasing order.
loan$ProsperRating <- factor(loan$ProsperRating, levels = c("HR", "E", "D", "C", "B", "A", "AA"))

#Plot
ggplot(aes(ProsperRating), data = subset(loan, !is.na(ProsperRating))) +
  geom_bar() +
  geom_text(stat = 'count', aes(label = ..count..), size = 3, vjust = -0.4) +
  ylab('Number of Borrowers') +
  ggtitle('Prosper Rating Plot') +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 10, color = 'grey0'),
        plot.title = element_text(family = 'Times', face = 'bold.italic', color = 'black', hjust = 0.5))
```

- The highest number of borrowers loans have a rating of C.
- As expected the maximum data lies into the 'B', 'C', 'D' categories, which is a medium rating.

### {#ProsperRating_LoanStanding_plot}
```{r echo=FALSE, message=FALSE, warning=FALSE, LoanStanding_by_ProsperRating_plot}
#Plot
ggplot(aes(ProsperRating, fill = LoanStanding), data = subset(loan, !is.na(ProsperRating))) +
  geom_bar(position = 'dodge') +
  geom_text(stat = 'count', aes(label = ..count..), size = 3, position = position_dodge(width = 0.9), vjust = -0.4) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Prosper Rating') +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 10, color = 'grey0'),
        plot.title = element_text(family = 'Times', face = 'bold.italic', color = 'black', hjust = 0.5),
        legend.title = element_text(size = 9), legend.justification = c(1,1), legend.position = c(1,1))
```

- The loans with low Prosper Rating of 'HR', 'E' & 'D' have comparatively higher Bad LoanStanding borrowers.
- Just from the numbers, loans with rating 'D' have the highest number of borrowers.

***

### Create a new column 'ProsperRiskRating' to categorize based on ProsperScore and ProsperRating

```{r echo=FALSE, message=FALSE, warning=FALSE, create_ProsperRiskRating}
#Assign categories and populate them
loan$ProsperRiskRating <- ifelse(loan$ProsperScore == "1" |
                                   loan$ProsperScore == "2" |
                                   loan$ProsperScore == "3" |
                                   loan$ProsperScore == "4" |
                                   loan$ProsperRating == "HR" |
                                   loan$ProsperRating == "E" |
                                   loan$ProsperRating == "D", 'High',
                                 ifelse(loan$ProsperScore == "5" |
                                          loan$ProsperScore == "6" |
                                          loan$ProsperScore == "7" |
                                          loan$ProsperRating == "C" |
                                          loan$ProsperRating == "B", 'Medium', 'Low'))
#Convert to Factor 
loan$ProsperRiskRating <- factor(loan$ProsperRiskRating, levels = c('High', 'Medium', 'Low'), ordered = T)
```

- Created a new column 'ProsperRiskRating', categorizing borrowers after July 2009 into 'High', 'Medium' and 'Low' risk.
- Borrowers with Prosper Score of 1,2,3,4 & Prosper Rating of 'HR', 'E', 'D' categorized into "High".
- Borrowers with Prosper Score of 5,6,7 & Prosper Rating of 'C', 'B' categorized into "Medium".
- Borrowers with Prosper Score of 8,9,10,11 & Prosper Rating of 'A', 'AA' categorized into "Low".

***

## ProsperRiskRating Analysis {#ProsperRiskRating_Univariate}

```{r echo=FALSE, message=FALSE, warning=FALSE, ProsperRiskRating_plot}
#Plot
ggplot(aes(ProsperRiskRating, fill = ProsperRiskRating),
       data = subset(loan, !is.na(ProsperRiskRating))) +
  geom_bar() +
  geom_text(stat = 'count', aes(label = ..count..), vjust = -0.4, size = 3.5) +
  scale_fill_manual(values = c('red4', 'darkgoldenrod', 'green4')) +
  ylab('Number of Borrowers') +
  ggtitle('Prosper Risk Rating Plot') +
  theme_minimal() +
  theme(legend.position = 'none',
        axis.text.x = element_text(size = 11, color = 'grey0', face = 'italic'),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
```

- Plot shows that the number of borrowers with Medium Prosper Risk Rating is highest, followed by High Prosper Risk Rating.

### {#ProsperRiskRating_LoanStanding_plot}
```{r echo=FALSE, message=FALSE, warning=FALSE, LoanStanding_ProsperRiskRating_plot}
#Plot
ggplot(aes(ProsperRiskRating, fill = LoanStanding), data = subset(loan, !is.na(ProsperRiskRating))) +
  geom_bar(position = 'dodge') +
  geom_text(stat = 'count', aes(label = ..count..), position = position_dodge(width = 0.9), size = 3.5, vjust = -0.4) +
  ylab('Number of Borrowers') +
  ggtitle('Loan Standing by Prosper Risk Rating') +
  theme_minimal() +
  theme(legend.position = c(1,1), legend.justification = c(1,1),
        axis.text.x = element_text(size = 11, color = 'grey0', face = 'italic'),
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))

```

- The proportion of Bad LoanStanding borrowers is significantly lesser in Low Prosper Risk Rating borrowers (4%).
- The proportion of Bad LoanStanding borrowers is highest in High Prosper Risk Rating borrowers (15%). 

***

## Borrower State Analysis {#BorrowerState_Univariate}

- Create a new column with full State names to match the abbreviated names in BorrowerState.
- Group the data by State.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=9, fig.width=12, Borrowers_by_state_plot}
# Map the abbreviated names to their full names
loan$BorrowerStateName <- tolower(state.name[match(loan$BorrowerState, state.abb)])
#Create new variables with state names
us <- map_data("state")
states <- data.frame(state.center, state.abb)

#Group by State
grp_by_state <- loan %>%
  group_by(BorrowerStateName, BorrowerState) %>%
  summarise(count = n()) %>%
  na.omit()

# Plotting on a map
ggplot() + 
  geom_map(data = us, map = us, aes(x = long, y = lat, map_id = region, label = region),
            fill="#ffffff", color="#ffffff", size=0.15) +
  geom_map(data = grp_by_state, map=us, aes(fill = count, map_id = BorrowerStateName),
            color = "#ffffff", size = 0.15) +
  geom_text(data = states, 
            aes(x = x, y = y, label = state.abb, group = NULL), size = 2) +
  scale_fill_continuous('Number of Borrowers', low = 'azure2', high = 'dodgerblue4') +
  coord_map("albers", lat0 = 39, lat1 = 45) +
  ggtitle('Number of Borrowers by State') +
  theme(panel.border = element_blank(), panel.background = element_blank(),
        axis.ticks = element_blank(), axis.text = element_blank(), axis.title = element_blank(),
        legend.position = 'bottom', legend.justification = 'top', legend.direction = 'horizontal',
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
#Tabulate number of borrowers by state
as.table(by(grp_by_state$count, grp_by_state$BorrowerStateName, sum))
```

- From the map and the table, it can be seen that the maximum number of borrowers are from California followed by Texas, New York & Florida.
- This can be justified, as Prosper started in California. California is also a highly populated state.
- The mid-west region states like Wyoming, North Dakota, South Dakota, Iowa have very less number of borrowers.

### {#BorrowerState_LoanStanding_plot}
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.height=9, fig.width=12, BorrowerState_LoanStanding_Plot}
#New dataset with Loan standing by borrowerstate
grp_by_state_LoanStanding <- loan %>%
  group_by(BorrowerStateName, BorrowerState, LoanStanding) %>%
  summarise(count = n()) %>%
  na.omit()
#Transform the dataset to wide format
grp_by_state_LoanStanding_wide <- dcast(grp_by_state_LoanStanding,
                                    BorrowerStateName + BorrowerState ~ LoanStanding,
                                    value.var = 'count')
#Add column to show the percentage of badstanding borrowers by state
grp_by_state_LoanStanding_wide$proportion_BadStanding <- 
  round((grp_by_state_LoanStanding_wide$Bad/
           (grp_by_state_LoanStanding_wide$Bad + grp_by_state_LoanStanding_wide$Good))*100,2) 

#Plot the map
ggplot() + 
  geom_map(data = us, map = us, aes(x = long, y = lat, map_id = region, label = region),
            fill="#ffffff", color="#ffffff", size=0.15) +
  geom_map(data = grp_by_state_LoanStanding_wide, map=us, aes(fill = proportion_BadStanding, map_id = BorrowerStateName),
            color = "#ffffff", size = 0.15) +
  geom_text(data = states, 
            aes(x = x, y = y, label = state.abb, group = NULL), size = 2) +
  scale_fill_continuous('Percentage', low = 'lightpink', high = 'red4') +
  coord_map("albers", lat0 = 39, lat1 = 45) +
  ggtitle('Proportion of Bad Loan Standing Borrowers by State') +
  theme(panel.border = element_blank(), panel.background = element_blank(),
        axis.ticks = element_blank(), axis.text = element_blank(), axis.title = element_blank(),
        legend.position = 'bottom', legend.justification = 'top', legend.direction = 'horizontal',
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
#Summary of the data as atable
as.table(by(grp_by_state_LoanStanding_wide$proportion_BadStanding, grp_by_state_LoanStanding_wide$BorrowerStateName, sum))
```

- The state with the highest proportion of Bad LoanStanding borrowers is Maine followed by Iowa and North Dakota.
- The lowest proportion of Bad LoanStanding borrowers is in Nebraska, followed by Alaska & Wyoming.

### {#BorrowerState_ProsperRiskRating_plot}
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=9, fig.width=12, BorrowerState_ProsperRisk_plot}
#New dataset by borrower state and ProsperRiskRating
grp_by_state_ProsperRisk <- loan %>%
  group_by(BorrowerStateName, BorrowerState, ProsperRiskRating) %>%
  summarise(count = n()) %>%
  na.omit()
#Transform to wide format
grp_by_state_ProsperRisk_wide <- dcast(grp_by_state_ProsperRisk,
                                    BorrowerStateName + BorrowerState ~ ProsperRiskRating,
                                    value.var = 'count')
#Add a column for percentage of high risk
grp_by_state_ProsperRisk_wide$proportion_HighRisk <- 
  round((grp_by_state_ProsperRisk_wide$High/
           (grp_by_state_ProsperRisk_wide$High + grp_by_state_ProsperRisk_wide$Medium +
                                               grp_by_state_ProsperRisk_wide$Low) * 100),2)
#Add a column for percentage of low risk
grp_by_state_ProsperRisk_wide$proportion_LowRisk <- 
  round((grp_by_state_ProsperRisk_wide$Low/
           (grp_by_state_ProsperRisk_wide$Low + grp_by_state_ProsperRisk_wide$Medium +
                                              grp_by_state_ProsperRisk_wide$High) * 100),2)

#Plot the map
ggplot() + 
  geom_map(data = us, map = us, aes(x = long, y = lat, map_id = region, label = region),
            fill="#ffffff", color="#ffffff", size=0.15) +
  geom_map(data = grp_by_state_ProsperRisk_wide, map=us, aes(fill = proportion_HighRisk, map_id = BorrowerStateName),
            color = "#ffffff", size = 0.15) +
  geom_text(data = states, 
            aes(x = x, y = y, label = state.abb, group = NULL), size = 2) +
  scale_fill_continuous('Percentage', low = 'lightpink', high = 'red4') +
  coord_map("albers", lat0 = 39, lat1 = 45) +
  ggtitle('Proportion of High ProsperRisk Rating Borrowers by State') +
  theme(panel.border = element_blank(), panel.background = element_blank(),
        axis.ticks = element_blank(), axis.text = element_blank(), axis.title = element_blank(),
        legend.position = 'bottom', legend.justification = 'top', legend.direction = 'horizontal',
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
#Tabulate the summary findings
as.table(by(grp_by_state_ProsperRisk_wide$proportion_HighRisk, grp_by_state_ProsperRisk_wide$BorrowerStateName, sum))

#Plot Map2
ggplot() + 
  geom_map(data = us, map = us, aes(x = long, y = lat, map_id = region, label = region),
            fill="#ffffff", color="#ffffff", size=0.15) +
  geom_map(data = grp_by_state_ProsperRisk_wide, map=us, aes(fill = proportion_LowRisk, map_id = BorrowerStateName),
            color = "#ffffff", size = 0.15) +
  geom_text(data = states, 
            aes(x = x, y = y, label = state.abb, group = NULL), size = 2) +
  scale_fill_continuous('Percentage', low = 'lightgreen', high = 'green4') +
  coord_map("albers", lat0 = 39, lat1 = 45) +
  ggtitle('Proportion of Low ProsperRisk Rating Borrowers by State') +
  theme(panel.border = element_blank(), panel.background = element_blank(),
        axis.ticks = element_blank(), axis.text = element_blank(), axis.title = element_blank(),
        legend.position = 'bottom', legend.justification = 'top', legend.direction = 'horizontal',
        plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', color = 'black'))
#Tabulate the summary findings
as.table(by(grp_by_state_ProsperRisk_wide$proportion_LowRisk, grp_by_state_ProsperRisk_wide$BorrowerStateName, sum))
```

- States of Iowa, Maine & North Dakota do not have borrowers with ProsperRiskRating, meaning, no Prosper users post July 2009.
- Proportion of loans with High ProsperRisk is highest in Arkansas followed by Wyoming & Mississippi.
- Proportion of Low ProsperRisk loans to borrowers is highest in California followed by Illinois, Delaware & Massachusetts.

***

# Univariate Analysis Summary
***

## Did you create any new variables from existing variables in the dataset?
In order to facilitate my analysis of the Prosper loans data, I created new variables from existing variables.  

- **ListingCategoryName** --- It contains the Listing Category name corresponding to the number in the *ListingCategory..numeric.* column.  

- **BorrowerStateName** --- This variable contains the state names corresponding to the abbreviation in the *BorrowerState* column.  

- **CreditScore** --- This variable contains the average CreditScore of a borrower. It is calculated by taking the average of the *CreditScoreRangeLower* and corresponding *CreditScoreRangeUpper*.  

- **LoanStanding** --- This variable is derived from the *LoanStatus* variable. Categorizes the loan risk attributed to the borrowers based on their loan status. 
    - Bad - Borrowers with loan status: PastDue, Default & Chargedoff.
    - Good - Borrowers with loan status: Current, Completed, Cancelled & FinalPaymentInProgress.  
   
- **ProsperRiskRating** --- This variable is derived from *ProsperScore* and *ProsperRating..Alpha.*. Categorizes the risk based on the Prosper Score and the Prosper Rating of the loan. Applicable for loans originated after July 2009.
    - High - Loans with ProsperScore "1,2,3,4" and ProsperRating "HR","E","D" *(Worst possible combination)*
    - Medium - Loans with ProsperScore "5,6,7" and ProsperRating "B","C"
    - Low - Loans with ProsperScore "8,9,10,11" and ProsperRating "A","AA" *(Best possible combination)*  
    - *One thing to note is that Prosper assigns more loans with a lower ProsperRating than 'A','AA', because they would rather be wrong about a bad loan actually turning out good than a good loan turning out bad.*

***

## What are the main features of interest in your dataset?

- The main features of interest in my dataset are LoanRisk and ProsperRiskRating.  
- ProsperRiskRating is derived from Prosper Score and Prosper Rating.  
   - The [Prosper score](https://www.prosper.com/plp/general-prosper_score/) estimates the probability of a loan going “bad,” where “bad” is the probability of going 60+ days past due within the first twelve months from the date of loan origination.  
   - Prosper score is a variable that Prosper assigns to loans to determine the risk they pose to investors. This score takes into account a number of variables such as debt to income ratio, loan payment performance on prior loans, credit card utilization, number of delinquent accounts and others.  
   - Prosper rating is based on the Prosper score and credit score.  

***

## Supporting features to help investigate the features of interest?  

- *IsBorrowerHomeowner* ---  I want to see which category of borrowers (owning or not owning a home) is associated with good and bad Loan Standing. If a borrower owns a home, that means a bank has already approved them for a loan. This would be a good sign to indicate trust.  
- *BorrowerAPR*  
- *CreditScore*   
- *DebtToIncomeRatio*  
- *EmploymentStatusDuration*   
- *EmployementStatus* --- The categories in this variable seem rather vague and are probably not useful at predicting loan Standing.  
- *IncomeRange* --- Investigate if higher incomes are associated with greater loan payback success.
- *LoanOriginalAmount*

***

## Unusual Observations & operations to tidy or adjust the data.

1. The most unusual findings from the analysis so far are ---
- There are some borrowers with an [employement duration](#EmploymentDuration_Univariate) of more than 60yrs.  
- The number of borrowers with an [income](#IncomeRange_LoanStanding_plot) of "$100,000+" is very high (more than "$75000-99,999"). This could be because larger number of users with high income consider a peer-to-peer loan.   
- There are borrowers with [CreditScore](#CreditScore_LoanStanding_plot) of 0. One of the reasons could be that they are young borrowers with no previous credit history.  
- [DebtToIncomeRatio](#DebtToIncomeRatio_Univariate) data shows a right skewed distribution. One of the reasons could be because, borrowers with higher income are able to handle more debt. Credit score histogram should overlap.  
- The [Borrower APR](#BorrowerAPR_Univariate) data also shows a right skewed distribution. Based on previous observations and assumptions I expected this plot to be left skewed, i.e., the borrowers with high credit scores should qualify for lower APR.  
- The [states](#BorrowerState_ProsperRiskRating_plot) of Maine, Iowa & North Dakota do not have any borrowers post July 2009.  

2. The operations I did to tidy or adjust data are ---
- Converted the Term variable to categorical with "12", "36", "60" categories.
- Combined all the Past due categories to "Delinquent" in LoanStatus variable.  
- Created a new column, Loan Standing based on the Loan Status of borrowers, categorizing into Good and Bad Standing.  
- Created a new column, Listing Category Name containing the name of the listing category corresponding to its number.  
- I set the EmploymentStatusDuration of all Not employed to 0 and removed NA’s. Due to this, the data shows employment duartion rather than employment status duration.  
- In the IncomeRange variable, I set the income of all Not Employed to $0. Ordered the categories in ascending order.  
- Considered only Verifiable Income in the Income Range Analysis.
- Created a new Variable for CreditScore containing the average of CreditScoreRangeLower and CreditScoreRangeUpper.  
- Converted the data in Prosper Score variable to factor. Ordered the factors in an ascending fashion.   
- Converted the Prosper Rating variable to factor and ordered it from worst to best.   
- Created a new variable, ProsperRiskRating where i categorized borrowers based on the best, average and worst combinations of ProsperScore and ProsperRating.  
- Created a new variable, BorrowerStateName which contains the full name of the borrower's state. It is useful to group and map the data.  
- Filtered out the NA's in all variables when plotting.

***

# Bivariate Analysis {#Bivariate}
***

## Plot Matrix of the non-categorical variables and LoanRisk {#non-categorical_LoanRisk_plot_matrix}

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=9, fig.width=12, non-categorical_LoanRisk_plot_matrix}
#Subset the dataset to remove the unnecesary columns
drop = c("ListingCategory..numeric.", "CreditScoreRangeLower", "CreditScoreRangeUpper")
loan <- loan[ , !(names(loan) %in% drop)]

#Plot Matrix
ggpairs(subset(loan, select = c(LoanStanding, LoanOriginalAmount, EmploymentStatusDuration,
                                BorrowerAPR, DebtToIncomeRatio, CreditScore)))
```

- There does not appear to be strong [linear correlations](https://en.wikiversity.org/wiki/Correlation) between the variables.
- The relationship between "CreditScore - BorrowerAPR", "CreditScore - LoanOriginalAmount" & "CreditScore - DebtToIncomeRatio"  needs a deeper look.
- The relationsip of LoanStanding with the other variables is as expected, with Bad Loan Standing associated with high BorrowerAPR, low CreditScore, low LoanOriginalAmount and low EmploymentStatusDuration.

***

## Plot Matrix of the non-categorical variables and ProsperRiskRating {#non-categorical_ProsperRiskRating_plot_matrix}

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=9, fig.width=12, non-categorical_ProsperRiskRating_plot_matrix}

#Create new dataframe with data post July 2009
loan_2009 <- subset(loan, !is.na(ProsperRiskRating))
#Plot matrix
ggpairs(subset(loan_2009, select = c(ProsperRiskRating, LoanOriginalAmount, EmploymentStatusDuration,
                                BorrowerAPR, DebtToIncomeRatio, CreditScore)))
```

- There are no strong correlation between the variables.
- There is a moderate negative relationship between CreditScore and BorrowerAPR which is expected.
- The relationship of ProsperRiskRating with other variables is expected, with High Risk associated with low LoanOriginalAmount, High BorrowerAPR, High DebtToIncomeRatio and Low CreditScore.
- An interesting find is that the mean EmploymentStatusDuartion is very close for High, Medium and Low ProsperRiskRating, with less employment duration having less risk.  

***

## Plot Matrix of the categorical variables and ProsperRiskRating {#categorical_plot_matrix}

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.height=9, fig.width=12, categorical_plot_matrix}
#Categorical Plot Matrix
ggpairs(subset(loan_2009, select = -c(Term, LoanStatus, IncomeVerifiable,
                                 LoanOriginalAmount, EmploymentStatusDuration, BorrowerAPR,
                                 DebtToIncomeRatio, CreditScore, BorrowerState,
                                BorrowerStateName, ListingCategoryName,
                                ProsperScore, ProsperRating)))
```

- The relationships between each other are not obvious except with our features of interest - LoanStanding and ProsperRiskRating.

***

## BorrowerAPR by CreditScore Analysis {#CreditScore_BorrowerAPR_plot}

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=10, fig.width=10, CreditScore_BorrowerAPR_plot}
#Initial Scatterplot
a1 <- ggplot(aes(x = CreditScore, y = BorrowerAPR),
       data = subset(loan, !is.na(BorrowerAPR) & !is.na(CreditScore))) +
  geom_jitter(alpha = 1/10) +
  theme_minimal() +
  ggtitle('BorrowerAPR by CreditScore') +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

#Scatterplot focusing on most of the data
a2 <- ggplot(aes(x = CreditScore, y = BorrowerAPR),
             data = subset(loan, !is.na(BorrowerAPR) & !is.na(CreditScore))) +
  geom_jitter(alpha = 1/20) +
  coord_cartesian(xlim = c(quantile(loan$CreditScore,0.01, na.rm = T), 800),
                  ylim = c(quantile(loan$BorrowerAPR,0.01, na.rm = T),
                           quantile(loan$BorrowerAPR, 0.99, na.rm = T))) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

grid.arrange(a1,a2)

#Create new dataframe with the mean and median BorrowerPR for each credit score
loan_APR_mean <- loan %>%
  na.omit() %>%
  group_by(CreditScore) %>%
  summarise(BorrowerAPR_mean = mean(BorrowerAPR),
            BorrowerAPR_median = median(BorrowerAPR),
            n = n()) %>%
  arrange(CreditScore)

#Plot the mean and median
b1 <- ggplot(aes(x = CreditScore, y = BorrowerAPR_mean), data = loan_APR_mean) +
  geom_line() +
  ggtitle('Mean BorrowerAPR by CreditScore') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

b2 <- ggplot(aes(x = CreditScore, y = BorrowerAPR_median), data = loan_APR_mean) +
  geom_line() +
  ggtitle('Median BorrowerAPR by CreditScore') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

grid.arrange(b1,b2)

#Check the correaltion Coefficient
cor(loan$CreditScore, loan$BorrowerAPR, use = 'complete.obs', method = 'pearson')
```

- In the first plot , we can see that most of the data is concentrated above credit score 500.
- In the second plot, focusing on the majority of data (99%), we can see that the Borrower APR is lower at higher Credit Score.
- In the mean and median plot, we see that there is a negative correlation between BorowerAPR and Credit Score (Increasing Credit Score = Lower BorowerAPR).

***

## Loan Original Amount by Credit Score Analysis {#CreditScore_LoanOriginalAmount_plot}

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=10, fig.width=10, CreditScore_LoanOriginalAmount_plot}
#Initial Plot focusing on 99% data
c1 <- ggplot(aes(x = CreditScore, y = LoanOriginalAmount),
       data = subset(loan, !is.na(LoanOriginalAmount) & !is.na(CreditScore))) +
  geom_jitter(alpha = 1/20) +
  coord_cartesian(xlim = c(quantile(loan$CreditScore,0.01, na.rm = T), 800),
                  ylim = c(quantile(loan$LoanOriginalAmount,0.01, na.rm = T),
                           quantile(loan$LoanOriginalAmount, 0.99, na.rm = T))) +
  theme_minimal() +
  ggtitle('LoanOriginalAmount by CreditScore') +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

#Create a dataframe of conditional means. Calculate the mean & median for each credit score
loan_Amount_Mean <- loan %>%
  na.omit() %>%
  group_by(CreditScore) %>%
  summarise(LoanOriginalAmount_mean = mean(LoanOriginalAmount),
            LoanOriginalAmount_median = median(LoanOriginalAmount),
            n = n()) %>%
  arrange(CreditScore)

#Plot the mean LoanOriginalAmount by CreditScore
c2 <- ggplot(aes(x = CreditScore, y = LoanOriginalAmount_mean), data = loan_Amount_Mean) +
  geom_line() +
  ggtitle('Mean LoanOriginalAmount by CreditScore') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

#Plot the median LoanOriginalAmount by CreditScore
c3 <- ggplot(aes(x = CreditScore, y = LoanOriginalAmount_median), data = loan_Amount_Mean) +
  geom_line() +
  ggtitle('Median LoanOriginalAmount by CreditScore') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

grid.arrange(c1,c2,c3)

#Calculate Correlation Coefficient
cor(loan$CreditScore, loan$LoanOriginalAmount, use = 'complete.obs', method = 'pearson')
```

- There appears to be a positive correlation between Credit Score and Loan amount.
- Looking at the line graph, we see an initial plateau (low credit score = less loan amount), a linear increase (increasing cedit score = increasing loan amount), a plateau with occasional peaks (increasing credit score = almost similar loan amounts, with occasional high loan amounts) and a linear increase at the end (incresing cedit score = increasing loan amount). 
- There is a moderate positive correlation between the variables.

***

## DebtToIncomeRatio by CreditScore Analysis {#DebtToIncomeRatio_CreditScore_plot}

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=10, fig.width=10, DebtToIncomeRatio_CreditScore_plot}
#Initial plot focusing on 99% data
d1 <- ggplot(aes(x = CreditScore, y = DebtToIncomeRatio),
       data = subset(loan, !is.na(DebtToIncomeRatio) & !is.na(CreditScore))) +
  geom_jitter(alpha = 1/20) +
  coord_cartesian(xlim = c(quantile(loan$CreditScore,0.01, na.rm = T), 800),
                  ylim = c(0,quantile(loan$DebtToIncomeRatio, 0.99, na.rm = T))) +
  theme_minimal() +
  ggtitle('DebtToIncomeRatio by CreditScore') +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

#Craete a new dataset with the mean & median
loan_ratio_mean <- loan %>%
  na.omit() %>%
  group_by(CreditScore) %>%
  summarise(DebtToIncomeRatio_mean = mean(DebtToIncomeRatio),
            DebtToIncomeRatio_median = median(DebtToIncomeRatio),
            n = n()) %>%
  arrange(CreditScore)
  
#Plot the mean and median
d2 <- ggplot(aes(x = CreditScore, y = DebtToIncomeRatio_mean), data = loan_ratio_mean) +
  geom_line() +
  ggtitle('Mean DebtToIncomeRatio by CreditScore') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

d3 <- ggplot(aes(x = CreditScore, y = DebtToIncomeRatio_median), data = loan_ratio_mean) +
  geom_line() +
  ggtitle('Median DebtToIncomeRatio by CreditScore') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

grid.arrange(d1,d2,d3)

#Calculate Correlation Coefficient
cor(loan$CreditScore, loan$DebtToIncomeRatio, use = 'complete.obs', method = 'pearson')
```

- The distribution of data does not look linear in the first plot.
- Looking at the mean and median plots, the data distribution is almost a parabola.
- There appear to be three regions in the plots. 
   - The first for which credit scores are relatively low and debt-to-income ratios are decreasing. 
   - The second for which debt-to-income ratios have a peak mean and median but with average credit scores. 
   - The third for which debt to income ratios are low but credit scores are good. 
   - The two ends of the plot might be associated with the lowest and highest income ranges.

***

## IncomeRange Analysis {#CreditScore_IncomeRange_Analysis}

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.height=10, fig.width=10, CreditScore_IncomeRange_Analysis}

#Plot data for verifiable income only
e1 <- ggplot(aes(x = IncomeRange, y = CreditScore),
       data = subset(loan, IncomeVerifiable == 'True' & !is.na(IncomeRange) & !is.na(CreditScore))) + 
  geom_boxplot() + 
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  ggtitle('CreditScore by Income Range') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))  

#BorrowerAPR by IncomeRange
e2 <- ggplot(aes(x = IncomeRange, y = BorrowerAPR),
       data = subset(loan, IncomeVerifiable == 'True' & !is.na(IncomeRange) & !is.na(BorrowerAPR))) + 
  geom_boxplot() + 
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  ggtitle('BorrowerAPR by Income Range') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

grid.arrange(e1,e2)
```

- From the plot we can see that the mean & median CreditScore increases with higher IncomeRange.
- There seem to be significant outliers in the "$1-24,999" & "$100,000+" categories.
- The range of CreditScore is high in the "$0" category. This could be because of Job loss or bankruptcy. 
- With the exception of '$0' category, The mean and median BorrowerAPR reduces with increasing income which is expected.
- There is a significant difference between mean & median of '$0' category and a wide Interquartile range.
- The mean & median BorrowerAPR for '$0' category is lower than all other categories. This could explain the [DebtToIncomeRatio by CreditScore](#DebtToIncomeRatio_CreditScore_plot) plot.

***

## Listing Category Analysis {#ListingCategory_plots}

```{r echo=FALSE, warning=FALSE, message=FALSE, ListingCategory_plots}
#Loan Original Amount vs Listing Category
ggplot(aes(x = ListingCategoryName, y = LoanOriginalAmount, color = ListingCategoryName), data = loan) +
  geom_boxplot() +
  ggtitle('Loan Original Amount by Listing Category') +
  theme_minimal() +
  stat_summary(fun.y=mean, geom="point", color = "black", shape = 1, size=1.2) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.9, size = 8, colour = 'grey0'), legend.position = 'none',
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))

#BorrowerAPR vs ListingCategory
ggplot(aes(x = ListingCategoryName, y = BorrowerAPR, color = ListingCategoryName), data = loan) +
  geom_boxplot() +
  ggtitle('BorrowerAPR by Listing Category') +
  theme_minimal() +
  stat_summary(fun.y=mean, geom="point", color = "black", shape = 1, size=1.2) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.9, size = 8, colour = 'grey0'), legend.position = 'none',
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))

#CreditScore vs Listing Category
ggplot(aes(x = ListingCategoryName, y = CreditScore, color = ListingCategoryName),
       data = subset(loan, !is.na(loan$CreditScore))) +
  geom_boxplot() +
  coord_cartesian(ylim = c(quantile(loan$CreditScore,0.01, na.rm = T), 900)) +
  ggtitle('CreditScore by Listing Category') +
  theme_minimal() +
  stat_summary(fun.y=mean, geom="point", color = "black", shape = 1, size=1.2) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.9, size = 8, colour = 'grey0'), legend.position = 'none',
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))

```

- 'Debt Consolidation' has the highest mean & median loan amount.  
- The mean loan amount for 'Baby&Adoption' is the second highest.
- The mean & median BorrowerAPR is highest for 'Cosmetic Procedure' followed by 'Household Expenses'.
- The lowest mean & median BorrowerAPR is for 'Personal Loan' and 'Not Available'.
- The interquartile range of CreditScore is widest for 'Not Available'. The mean & median CreditScore is least for the same.
- The highest mean & median CreditScore is for 'Boat' which is expected.

***

## Term Analysis {#Term_plots}

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=10, fig.width=10, Term_plots}
#LoanOriginalAmount by Term
f1 <- ggplot(aes(x = Term, y = LoanOriginalAmount), data = loan) +
  geom_boxplot() +
  ggtitle('Loan Original Amount by Term') +
  theme_minimal() +
  stat_summary(fun.y=mean, geom="point", color = "red4", shape = 1, size=2) +
  theme(axis.text.x = element_text(size = 10, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))

#BorrowerAPR by Term
f2 <- ggplot(aes(x = Term, y = BorrowerAPR), data = loan) +
  geom_boxplot() +
  ggtitle('BorrowerAPR by Term') +
  theme_minimal() +
  stat_summary(fun.y=mean, geom="point", color = "red4", shape = 1, size=2) +
  theme(axis.text.x = element_text(size = 10, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))

grid.arrange(f1,f2)
```

- The 60 month loan term has the highest mean and median loan amounts.
- The 12 month loan period has the lowest mean and median loan amounts.
- The mean and median BorrowerAPR seems to be very close for all loan terms.
- The interquartile range of BorrowerAPR for 60 month term loans is the least.

***

## IsBorrowerHomeowner Analysis {#IsBorrowerHomeowner}

```{r echo=FALSE, warning=FALSE, message=FALSE, IsBorrowerHomeowner_Analysis}
#VS LoanOriginalAmount
ggplot(aes(x= IsBorrowerHomeowner, y = LoanOriginalAmount), data = loan) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, quantile(loan$LoanOriginalAmount, 0.99, na.rm = T))) +
  scale_x_discrete(labels = c("No", "Yes")) +
  ggtitle('LoanOriginalAmount by IsBorrowerHomeowner') +
  stat_summary(fun.y=mean, geom="point", color = "red4", shape = 1, size=2) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))
#Summary
by(loan$LoanOriginalAmount, loan$IsBorrowerHomeowner, summary)
  
#VS CreditScore
ggplot(aes(x= IsBorrowerHomeowner, y = CreditScore),
       data = subset(loan, !is.na(CreditScore))) +
  geom_boxplot() +
  coord_cartesian(ylim = c(quantile(loan$CreditScore, 0.01, na.rm = T),
                           quantile(loan$CreditScore, 0.99, na.rm = T))) +
  scale_x_discrete(labels = c("No", "Yes")) +
  ggtitle('CreditScore by IsBorrowerHomeowner') +
  stat_summary(fun.y=mean, geom="point", color = "red4", shape = 1, size=2) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))
#Summary
by(loan$CreditScore, loan$IsBorrowerHomeowner, summary)

#VS BorrowerAPR
ggplot(aes(x= IsBorrowerHomeowner, y = BorrowerAPR),
       data = subset(loan, !is.na(BorrowerAPR))) +
  geom_boxplot() +
  coord_cartesian(ylim = c(quantile(loan$BorrowerAPR, 0.01, na.rm = T),
                           quantile(loan$BorrowerAPR, 0.99, na.rm = T))) +
  scale_x_discrete(labels = c("No", "Yes")) +
  ggtitle('BorrowerAPR by IsBorrowerHomeowner') +
  stat_summary(fun.y=mean, geom="point", color = "red4", shape = 1, size=2) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))
#Summary
by(loan$BorrowerAPR, loan$IsBorrowerHomeowner, summary)

#VS DebtToIncomeRatio
ggplot(aes(x= IsBorrowerHomeowner, y = DebtToIncomeRatio),
       data = subset(loan, !is.na(DebtToIncomeRatio))) +
  geom_boxplot() +
  coord_cartesian(ylim = c(quantile(loan$DebtToIncomeRatio, 0.01, na.rm = T),
                           quantile(loan$DebtToIncomeRatio, 0.99, na.rm = T))) +
  scale_x_discrete(labels = c("No", "Yes")) +
  ggtitle('DebtToIncomeRatio by IsBorrowerHomeowner') +
  stat_summary(fun.y=mean, geom="point", color = "red4", shape = 1, size=2) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))
#Summary
by(loan$DebtToIncomeRatio, loan$IsBorrowerHomeowner, summary)

#VS Employment Duration
ggplot(aes(x= IsBorrowerHomeowner, y = EmploymentStatusDuration),
       data = subset(loan, EmploymentStatus %in% condition, !is.na(EmploymentStatusDuration))) +
  geom_boxplot() +
  coord_cartesian(ylim = c(quantile(loan$EmploymentStatusDuration, 0.01, na.rm = T),
                           quantile(loan$EmploymentStatusDuration, 0.99, na.rm = T))) +
  scale_x_discrete(labels = c("No", "Yes")) +
  ggtitle('EmploymentStatusDuration by IsBorrowerHomeowner') +
  stat_summary(fun.y=mean, geom="point", color = "red4", shape = 1, size=2) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))
#Summary
by(loan$EmploymentStatusDuration, loan$IsBorrowerHomeowner, summary)

#VS IncomeRange
ggplot(aes(x= IsBorrowerHomeowner, y = IncomeRange),
       data = subset(loan, !is.na(IncomeRange) &
                       IncomeVerifiable == "True" & IncomeRange != "Not displayed")) +
  geom_jitter(alpha = 1/23) +
  scale_x_discrete(labels = c("No", "Yes")) +
  ggtitle('IncomeRange by IsBorrowerHomeowner') +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 12, colour = 'grey0'),
        plot.title = element_text(hjust = 0.5, face = 'bold.italic', color = 'black', family = 'Times'))
#Summary
by(loan$IncomeRange, loan$IsBorrowerHomeowner, summary)

```

- The mean and median LoanOriginalAmount is higher (2583, 3000 respectively) for Homeowners which shows an  expected relationship between the two.
- The mean and median CreditScore is higher (39, 20 respectively) for Homeowners.
- The mean and median BorrowerAPR is slightly lower (0.021, 0.027) for Homeowners.
- The median DebtToIncomeRatio is marginally lower (0.01) for non-homeowners and the mean is the same. The mean and median are significantly far apart signifying alot of outliers. 
- Looking at the plot we can see that there is no significant relationship between DebtToIncomeRatio and IsBorrowerHomeowner. I will not be considering this relationship for future analysis.
- The mean and median EmploymentStatusDuration is higher (33, 34) for Homeowners.
- In the IncomeRange by HomeOwner plot we can see that a significant number of non - homeowners have an income below $75,000. A significantly higher number of Homeowners have an income higher than $50,000.
- In conclusion, the analysis shows that Homeowners have longer employment duration, higher CreditScore, Lower APR and make more money than non Homeowners. I expect a significant relationship between IsBorrowerHomeowner and LoanStanding.

***

## Loan Standing Analysis {#LoanStanding_analysis}

```{r echo=FALSE, warning=FALSE, message=FALSE, LoanStanding_analysis}
#Employment Status Duration by Loan Standing

##I will not consider NA's and 'Not available' status 
Employment_condition <- c("Employed", "Full-time", "Part-time", "Self-employed",
                          "Retired", "Not employed")
#Plot
ggplot(aes(x = LoanStanding, y = EmploymentStatusDuration), 
       data = subset(loan,
                     EmploymentStatus %in% Employment_condition & !is.na(EmploymentStatusDuration))) +
  geom_boxplot() +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) + 
  coord_cartesian(ylim = c(0, quantile(loan$EmploymentStatusDuration, 0.95, na.rm = T))) +
  theme_minimal() +
  ggtitle('Employment Status Duration by Loan Standing') +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan$EmploymentStatusDuration, loan$LoanStanding, summary)

#Debt To Income Ratio by Loan Standing
ggplot(aes(x = LoanStanding, y = DebtToIncomeRatio), data = loan) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, quantile(loan$DebtToIncomeRatio, 0.99, na.rm = T))) +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  theme_minimal() +
  ggtitle('Debt To Income Ratio by Loan Standing') +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan$DebtToIncomeRatio, loan$LoanStanding, summary)

#BorrowerAPR by LoanStanding
ggplot(aes(x = LoanStanding, y = BorrowerAPR), data = loan) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, quantile(loan$BorrowerAPR, 0.99, na.rm = T))) +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  theme_minimal() +
  ggtitle('BorrowerAPR by Loan Standing') +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan$BorrowerAPR, loan$LoanStanding, summary)

#CreditScore by LoanStanding
ggplot(aes(x = LoanStanding, y = CreditScore), data = loan) +
  geom_boxplot() +
  coord_cartesian(ylim = c(quantile(loan$CreditScore, 0.01, na.rm = T),
                           quantile(loan$CreditScore, 0.99, na.rm = T))) +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  theme_minimal() +
  ggtitle('CreditScore by Loan Standing') +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan$CreditScore, loan$LoanStanding, summary)

```

- The employment duration is less for bad standing loans. The mean and median are lower than good standing loans.
- A statistical test for significance is needed to check if the difference in means and medians for good and bad standing loans is significant.
- The DebtToIncome Ratio plot shows an expected trend of higher DebtToIncome Ratio for bad standing loans.
- An interesting find is that the median DebtToIncome Ratio for good and bad standing loans is the same.
- The mean DebtToIncome Ratio for bad standing loans is greater than the 3rd quartile. This shows that there are many outliers with high DebtToIncome ratio. 
- The BorrowerAPR plot also shows an expected trend of higher APR for bad standing loans.
- Borrowers with a higher APR should have a harder time paying back loans so it is to be expected that their loans will have a higher rate of having a bad standing.

***

## ProsperRiskRating Analysis {#ProsperRiskRating_Analysis}

```{r echo=FALSE, message=FALSE, warning=FALSE, ProsperRiskRating_Analysis}
#LoanOriginalAmount by ProsperRiskRating
ggplot(aes(x = ProsperRiskRating, y = LoanOriginalAmount), data = loan_2009) +
  geom_boxplot() +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  ggtitle('Loan Amount by ProsperRisk Rating') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan_2009$LoanOriginalAmount, loan_2009$ProsperRiskRating, summary)

#Employment Duration by ProsperRiskRating
ggplot(aes(x = ProsperRiskRating, y = EmploymentStatusDuration), data = loan_2009) +
  geom_boxplot() +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  coord_cartesian(ylim = c(0, quantile(loan_2009$EmploymentStatusDuration, 0.99, na.rm = T))) +
  ggtitle('Employment Duration by ProsperRisk Rating') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan_2009$EmploymentStatusDuration, loan_2009$ProsperRiskRating, summary)

#BorrowerAPR by ProsperRiskRating
ggplot(aes(x = ProsperRiskRating, y = BorrowerAPR), data = loan_2009) +
  geom_boxplot() +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  ggtitle('BorrowerAPR by ProsperRisk Rating') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan_2009$BorrowerAPR, loan_2009$ProsperRiskRating, summary)

#DebtToIncomeRatio by ProsperRiskRating
ggplot(aes(x = ProsperRiskRating, y = DebtToIncomeRatio), data = loan_2009) +
  geom_boxplot() +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  coord_cartesian(ylim = c(0, quantile(loan_2009$DebtToIncomeRatio,0.95, na.rm = T))) +
  ggtitle('DebtToIncomeRatio by ProsperRisk Rating') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan_2009$DebtToIncomeRatio, loan_2009$ProsperRiskRating, summary)

#CreditScore by ProsperRiskRating
ggplot(aes(x = ProsperRiskRating, y = CreditScore), data = loan_2009) +
  geom_boxplot() +
  stat_summary(fun.y=mean, geom="point", color = "red", shape = 1, size=2) +
  ggtitle('CreditScore by ProsperRisk Rating') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'))

by(loan_2009$CreditScore, loan_2009$ProsperRiskRating, summary)

```

- Only borrowers post July 2009 have a ProsperRiskRating.
- The mean and median LoanOriginalAmount is significantly low for High Risk loans.
- The mean and median LoanOriginalAmount is very close for Medium & Low Risk loans.
- The mean & median Employment Duration for borrowers is very close to each other for all loans, which is an interesting find. I expected High risk loans to have a significantly lower Employment Duration compared to Low risk loans.
- The trend in the BorrowerAPR is expected. There is a significant increase in  mean and median of BorrowerAPR from Low risk to Medium risk to High Risk.

***

# Bivariate Analysis Summary
***

## How did the features of interest vary with other features in the dataset?

- The median [Employment duration](#LoanStanding_analysis) is higher for borrowers of Good Loan Standing. The difference on the mean and median Employment duration is very less (17,16), so i will not consider this feature for further analysis.
- The mean [DebtToIncome Ratio](#LoanStanding_analysis) is significantly higher for Bad Loan standing borrowers. The median is the same for both Good and Bad standing.
- The mean and median for [BorrowerAPR](#LoanStanding_analysis) is significantly higher for Bad Loan standing borrowers which is expected.
- The mean and median for [CreditScore](#LoanStanding_analysis) is lower for Borrowers with Bad Loan Standing. There is a 40 point difference in the median and a 47.5 point difference in the mean CreditScore between Good and Bad Standing loans.
- Significantly large number of [Employed Borrowers](#EmploymentStatus_LoanStanding_plot) have Good Standing loans. I will not be considering this variable for future analyses.
- The [majority](#IncomeRange_LoanStanding_plot) of borrowers with Good Standing loans made over $50,000. The majority of borrowers with Bad Standing loans made less than $75,000.
- Higher number of [Homeowners](#IsBorrowerHomeowner_LoanStanding_plot) have Good Standing loans. Larger number of non Homeowners have Bad Standing loans. The difference in the numbers is very small. I will not be considering this feature for future analysis.
- Higher number of borrowers with Bad Standing loans have High [ProsperRiskRating](#ProsperRiskRating_LoanStanding_plot). 
- The loans with low [Prosper Rating](#ProsperRating_LoanStanding_plot) of ‘HR’, ‘E’ & ‘D’ have comparatively higher Bad LoanStanding borrowers.
- The mean and median [LoanOriginalAmount](ProsperRiskRating_Analysis) is significantly low for High Risk loans. The mean and median LoanOriginalAmount is very close for Medium & Low Risk loans.
- The mean & median [Employment Duration](ProsperRiskRating_Analysis) for borrowers is very close to each other for all loans, which is an interesting find. I expected High risk loans to have a significantly lower Employment Duration compared to Low risk loans.
- The trend in the [BorrowerAPR](ProsperRiskRating_Analysis) is expected. There is a significant increase in mean and median of BorrowerAPR from Low risk to Medium risk to High Risk.

***

## Did you observe any interesting relationships between the other features?

- There is a negative correlation between BorowerAPR and Credit Score (Increasing Credit Score = Lower BorowerAPR).
- In the [LoanOriginalAmount by CreditScore](#CreditScore_LoanOriginalAmount_plot) plot, we see an initial plateau (low credit score = less loan amount), a linear increase (increasing credit score = increasing loan amount), a plateau with occasional peaks (increasing credit score = almost similar loan amounts, with occasional high loan amounts) and a linear increase at the end (increasing credit score = increasing loan amount).
- I found a relationship in the [DebtToIncomeRatio by CreditScore](#DebtToIncomeRatio_CreditScore_plot) plot that excluding the outliers, almost looks parabolic (pointing down). There are two regions to the far left and right of this graph for which the debt-to-income-ratio is relatively low but the credit score is low on the left end and high on the right end. My guess is that on the low end, one will find several loans which have borrowers making less than $50,000 a year and on the high end of credit score, one will find several loans which have borrowers making more than $50,000 a year.
- The range of CreditScore is high in the “$0” IncomeRange category. This could be because of Job loss or bankruptcy.
- The mean loan amount for the [ListingCategory](#ListingCategory_plots) ‘Baby&Adoption’ is the second highest after Debt Consolidation. The mean & median BorrowerAPR is highest for ‘Cosmetic Procedure’. The highest mean & median CreditScore is for ‘Boat’. 
- The 60 month [loan term](#Term_plots) has the highest mean and median loan amounts. The 12 month loan period has the lowest mean and median loan amounts. The mean and median BorrowerAPR seems to be very close for all loan terms.
- The mean and median LoanOriginalAmount is significantly low for High [ProsperRiskRating](#ProsperRiskRating_Analysis) loans. 
- The mean & median Employment Duration for borrowers is very close to each other for all loans, which is an interesting find. I expected High risk loans to have a significantly lower Employment Duration compared to Low risk loans.
- The trend in the BorrowerAPR is expected. There is a significant increase in mean and median of BorrowerAPR from Low risk to Medium risk to High Risk.

***

## What was the strongest relationship you found?

- The strongest relationship I found in the numerical variables is for [BorrowerAPR](#LoanStanding_analysis) followed by [CreditScore](#LoanStanding_analysis). 
- With the categorical variables, the strongest relationship i found is between IncomeRange, LoanStanding and ProsperRiskRating.

# Final Plots {#Multivariate}
***

## Mutivariate Plot 1 {#DebtToIncomeRatio_CreditScore_IncomeRange_LoanStanding}

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=9, DebtToIncomeRatio_CreditScore_IncomeRange}
# Subset the dataset to include only verifiable Income
loan_verifiable_income <- subset(loan, IncomeVerifiable == 'True' & !is.na(IncomeRange) & IncomeRange != 'Not displayed')

# Initial ScatterPlot to get a basic idea of the distribution
g1 <- ggplot(aes(x= CreditScore, y = DebtToIncomeRatio, color = IncomeRange),
             data = subset(loan_verifiable_income, !is.na(CreditScore) &
                             !is.na(DebtToIncomeRatio) & !is.na(IncomeRange))) +
  geom_point() +
  coord_cartesian(xlim = c(quantile(loan$CreditScore,0.01, na.rm = T), 900),
                  ylim = c(0,quantile(loan$DebtToIncomeRatio, 0.99, na.rm = T))) +
  scale_color_brewer(palette = "Spectral") +
  ggtitle('DebtToIncomeRatio across CreditScore by IncomeRange') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'),
        legend.title = element_text(size = 9), legend.text = element_text(size = 8))

#Jitter plot focusing on 99% data points
g2 <- ggplot(aes(x= CreditScore, y = DebtToIncomeRatio, color = IncomeRange),
             data = subset(loan_verifiable_income, IncomeVerifiable == 'True', !is.na(CreditScore) &
                             !is.na(DebtToIncomeRatio) & !is.na(IncomeRange))) +
  geom_jitter(alpha = 1/20) +
  coord_cartesian(xlim = c(quantile(loan$CreditScore,0.01, na.rm = T), 900),
                  ylim = c(0,quantile(loan$DebtToIncomeRatio, 0.99, na.rm = T))) +
  scale_color_brewer(palette = "Spectral") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'),
        legend.title = element_text(size = 9), legend.text = element_text(size = 8))
#Combine the two previous visualizations to create a grid
grid_arrange_shared_legend(g1,g2, ncol = 1, nrow = 2, position = 'right')

#Facet by ProsperRiskRating
ggplot(aes(x= CreditScore, y = DebtToIncomeRatio, color = IncomeRange),
             data = subset(loan_2009, IncomeVerifiable == 'True', !is.na(CreditScore) &
                             !is.na(DebtToIncomeRatio) & !is.na(IncomeRange))) +
  geom_jitter(alpha = 1/15, position = position_jitter()) +
  coord_cartesian(xlim = c(quantile(loan_2009$CreditScore,0.01, na.rm = T), 900),
                  ylim = c(0,quantile(loan_2009$DebtToIncomeRatio, 0.99, na.rm = T))) +
  scale_color_brewer(palette = "Spectral") +
  facet_wrap(~ProsperRiskRating) +
  ggtitle('Faceted by ProsperRiskRating') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'),
        legend.title = element_text(size = 9), legend.text = element_text(size = 8)) +
  guides(colour = guide_legend(override.aes = list(alpha = 1)))

#Facet by LoanStanding
ggplot(aes(x= CreditScore, y = DebtToIncomeRatio, color = IncomeRange),
             data = subset(loan_verifiable_income, !is.na(CreditScore) &
                             !is.na(DebtToIncomeRatio) & !is.na(IncomeRange))) +
  geom_jitter(alpha = 1/15, position = position_jitter()) +
  coord_cartesian(xlim = c(quantile(loan$CreditScore,0.01, na.rm = T), 900),
                  ylim = c(0,quantile(loan$DebtToIncomeRatio, 0.99, na.rm = T))) +
  scale_color_brewer(palette = "Spectral") +
  facet_wrap(~LoanStanding) +
  ggtitle('Faceted by LoanStanding') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'),
        legend.title = element_text(size = 9), legend.text = element_text(size = 8)) +
  guides(colour = guide_legend(override.aes = list(alpha = 1)))
```

- From the scatterplot and the jitter plot, we can see that the lower creditscores are dominated by borrowers falling in the "$0"-"$50,000" categories. The same borrowers have a higher debt to income ratio.
- From the  jitter plot, we can see that the higher credit scores are dominated by borrowers falling above the "$75,000" category. The same borrowers are concentrated at lower debt to income ratios.
- The faceted plot shows that the majority of borrowers in the Bad standing facet have income range lower than"$50,000".
- The majority of borrowers in the Good standing facet have income range more than "$50,000".
- The ProsperRiskRating facet follows a similar trend to Loan Standing. We see a majority of borrowers with income range lower than "$50,000" in the High Risk facet. A significant majority of borrowers in the Low risk facet have income more than "$75,000". The Medium risk facet is dominated by borrowers with income range higher than "$50,000".
- The overall trend of the plots show that higher proportion of borrowers with IncomeRange lower than "$50,000" have high DebtToIncomeRatio, Lower CreditScores, High ProsperRiskRating and Bad Standing Loans (Dominate the left upper part of the plots).
- Larger proportion of borrowers with IncomeRange higher than"$50,000" have lower DebtToIncomeRatio, higher CreditScore, Low to Medium ProsperRiskRating and Good Standing loans (Dominate the Right lower part of the plots).

***

## Multivariate plot 2 {#BorrowerAPR_CreditScore_IncomeRange_LoanStanding}

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.height=7, fig.width=9, BorrowerAPR_CreditScore_IncomeRange_LoanStanding}
#Create a ScatterPlot focusing on 99% data
ggplot(aes(x = CreditScore, y = BorrowerAPR, color = IncomeRange),
             data = subset(loan_verifiable_income, !is.na(CreditScore) & !is.na(BorrowerAPR) &
                             !is.na(IncomeRange))) +
  geom_jitter(alpha = 1/10) +
  coord_cartesian(xlim = c(quantile(loan_verifiable_income$CreditScore,0.01, na.rm = T), 900),
                  ylim = c(0,quantile(loan_verifiable_income$BorrowerAPR, 0.99, na.rm = T))) +
  scale_color_brewer(palette = "Spectral") +
  ggtitle('BorrowerAPR across CreditScore by IncomeRange') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'),
        legend.title = element_text(size = 9), legend.text = element_text(size = 8)) +
  guides(colour = guide_legend(override.aes = list(alpha = 1)))

#Facet by ProsperRiskRating
ggplot(aes(x = CreditScore, y = BorrowerAPR, color = IncomeRange),
             data = subset(loan_2009, !is.na(CreditScore) & !is.na(BorrowerAPR) &
                             !is.na(IncomeRange))) +
  geom_jitter(alpha = 1/10) +
  coord_cartesian(xlim = c(quantile(loan_2009$CreditScore,0.01, na.rm = T), 900),
                  ylim = c(0,quantile(loan_2009$BorrowerAPR, 0.99, na.rm = T))) +
  scale_color_brewer(palette = "Spectral") +
  facet_wrap(~ProsperRiskRating) +
  ggtitle('Facet by ProsperRiskRating') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'),
        legend.title = element_text(size = 9), legend.text = element_text(size = 8)) +
  guides(colour = guide_legend(override.aes = list(alpha = 1)))

#Facet by LoanStanding
ggplot(aes(x = CreditScore, y = BorrowerAPR, color = IncomeRange),
             data = subset(loan_verifiable_income, !is.na(CreditScore) & !is.na(BorrowerAPR) &
                             !is.na(IncomeRange))) +
  geom_jitter(alpha = 1/10) +
  coord_cartesian(xlim = c(quantile(loan_verifiable_income$CreditScore,0.01, na.rm = T), 900),
                  ylim = c(0,quantile(loan_verifiable_income$BorrowerAPR, 0.99, na.rm = T))) +
  scale_color_brewer(palette = "Spectral") +
  facet_wrap(~LoanStanding) +
  ggtitle('Facet by Loan Standing') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic'),
        legend.title = element_text(size = 9), legend.text = element_text(size = 8)) +
  guides(colour = guide_legend(override.aes = list(alpha = 1)))
```

- From the first jitter plot we can see that the left top is dominated by borrowers with income range less than "$50,000" and that the right bottom is dominated by borrowers with income range higher than "$75,000".
- Faceting by ProsperRiskRating, we see that majority of High risk loans have high APR and the borrower income range is less than "$50,000". Medium risk rating has loans with comparatively lower APR and the borrower income range seems to be well distributed above "$25,000". Low risk rating loans have a significantly lower APR and the borrower income range is dominated by above "$75,000".
- Faceting by Loan Standing, we see that a high proportion of borrowers with bad standing loans have an income lower than "$50,000" with higher APR loans. Good standing loans have a similar distribution of loan APR and CreditScore variance, but there is a higher proportion with income range above "$50,000".

***

## Multivariate Plot 3 {#State_LoanOriginalAmount_IsBorrowerHomeowner}

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.height=11, fig.width=16, State_LoanOriginalAmount_IsBorrowerHomeowner}
#Plot Median_LoanOriginalAmount_by_State_facet_by_LoanStanding
ggplot(aes(x=BorrowerState, y= LoanOriginalAmount, fill= IsBorrowerHomeowner),
       data = subset(loan, !is.na(BorrowerState))) +
  geom_bar(stat="summary", fun.y = median, position = "dodge", size = 1) +
  scale_fill_manual(values = c('firebrick2', 'springgreen3')) +
  ylab('Median Loan Original Amount') +
  ggtitle('Median Loan Original Amount across State by IsBorrowerHomeowner facet LoanStanding') +
  facet_wrap(~LoanStanding) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', size = 25),
        legend.position = c(1,1), legend.justification = c(1,1),
        axis.text.x = element_text(angle = 90, size = 10))

#Plot Median_LoanOriginalAmount_by_State_facet_by_ProsperRiskRating
ggplot(aes(x=BorrowerState, y= LoanOriginalAmount, fill= IsBorrowerHomeowner),
       data = subset(loan_2009, !is.na(BorrowerState))) +
  geom_bar(stat="summary", fun.y = median, position = "dodge", size = 1) +
  scale_fill_manual(values = c('firebrick2', 'springgreen3')) +
  ylab('Median Loan Original Amount') +
  ggtitle('Median Loan Original Amount across State by IsBorrowerHomeowner facet ProsperRiskRating') +
  facet_wrap(~ProsperRiskRating) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', size = 25),
        legend.position = c(1,1), legend.justification = c(1,1),
        axis.text.x = element_text(angle = 90, size = 8))
```

- We can see from the graph that homeowners have higher median loan amounts than people who do not own a home in all states.
- DC has the highest Median LoanOriginalAmount.
- The median LoanOriginalAmount  is lower for bad loans in all the states except in NH (where it is equal).
- By faceting with ProsperRiskRating, we can see that there is a significant decrease in median LoanOriginalAmount for High Risk loans in all States.
- The median LoanOriginalAmount for Medium and Low ProsperRiskRating Loans is almost similar.
- This is expected because Prosper assigns very few loans with Low Risk (Prosper prefers a High Risk loan being in Good Standing to a Low Risk loan going into Bad Standing.)
- IsBorrowerHomeowner is definitely a motivator for people to get a loan.  
- Owning a home means that the borrower has an existing approved loan which is a good indicator for lenders. Therefore Homeowners having a higher loan original amount and being in good loan standing is expected.

***

## Were there features that strengthened each other in terms of looking at your features of interest?

- IncomeRange and CreditScore strengthened each other in terms of predicting LoanStanding & ProsperRiskRating. From the BorrowerAPR vs CreditScore plot & DebtToIncomeRatio vs CreditScore plot, we can see that there were very few loans in a status of Bad LoanStanding & High ProsperRiskRating which had credit scores beyond 800 and also had an income above $50,000. There were also very few borrowers with CreditScore below 600 and with IncomeRange below $50,000 in the Good LoanStanding with Low ProsperRiskRating.
- For DebtToIncomeRatio, we can see that in borrowers making less than $50,000, the proportion of them who had Good & Bad LoanStanding with High & Medium ProsperRiskRating and had a DebtToIncomeRatio greater than 0.25 was far greater than that of borrowers making greater than $50,000 (most of the borrowers making greater than $50,000 were in Good LoanStanding with Medium & Low ProsperRiskRating category and had ratios less than 0.25). This was across all credit scores. The same could be said for BorrowerAPR but the difference in number of borrowers will be smaller between those making less than $50,000 and those making greater than $50,000.
- IsBorrowerHomeowner is definitely a motivator for people to get a loan. Owning a home means that the borrower has an existing approved loan which is a good indicator for lenders. Therefore Homeowners have higher median LoanOriginalAmount Loans in Good LoanStanding.
- In conclusion, IncomeRange and DebtToIncomeRatio strengthen each other more than IncomeRange and BorrowerAPR in terms of predicting LoanStanding and ProsperRiskRating. IsBorrowerHomeowner and LoanOriginalAmount also strengthen each other significantly in terms of predicting LoanStanding and ProsperRiskRating.

***

## Were there any interesting or surprising interactions between features?

-  I was surprised that the relationship of BorrowerAPR-IncomeRange was not as strong as DebtToIncomeRatio-IncomeRange. I expected the opposite would be true based off the bivariate box plots.  
- The significant difference in Median LoanOriginalAmount across all States between homeowners and non homeowners is also an interesting find.


## Final Plot {#LoanStanding_ProsperScore_ProsperRating}

- I will check the relationship between [LoanStanding and ProsperRiskRating](#ProsperRating_LoanStanding_plot). I will deconstruct the ProsperRiskRating variable to show and confirm the trends I've seen in my analysis.

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.height=15, fig.width=16, Final_Plot}
#LoanStanding_ProsperScore_ProsperRating_Plot
ggplot(aes(LoanStanding, fill = ProsperScore), data = loan_2009) +
  geom_bar() +
  facet_wrap(~ProsperRating) +
  ylab('Number of Borrowers') +
  scale_fill_brewer(palette = 'BrBG') +
  ggtitle('LoanStanding by ProsperScore facet by ProsperRating') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, family = 'Times', face = 'bold.italic', size = 25),
        axis.text.x = element_text(size = 9), 
        legend.text = element_text(size = 13), legend.title = element_text(size = 15))
```

- The first thing to notice is that there are significantly lesser loans assigned a rating of 'AA' that have Bad LoanStanding (Delinquent, Default & Chargedoff loans).
- Almost all of the 'AA' ProsperRating loans have ProsperScore above '6'. It appears then that for a loan to have a ProsperRating of 'AA' is to have a very low (almost 0%) chance of resulting in Bad Standing (Delinquent, Default & Chargedoff) loans (this is only for this sample data and more data would be needed to confirm this). 
- Starting with a ProsperRating of 'D' and continuing until 'HR', the proportion of Bad Standing (Delinquent, Default & Chargedoff) Loans seems to stay constant (around 1.25%) but the proportion of Good Standing (Current & Completed) loans continues to decrease. 
It should be noted that the proportion of Bad Standing (Delinquent, Default & Chargedoff) loans increases significantly from 'D' through 'HR'.
A ProsperRating of 'C' has the largest number of Good Standing (Current & Completed) loans with around an equal number of loans being between '1'-'6' and '7'-'11'. 
- The proportion of loans with Good Standing (Current & Completed) loans is greatest for 'AA' loans.
- The number of Bad Standing (Delinquent, Default & Chargedoff) loans increases from ProsperRating of 'AA' through 'HR' and the number of Good Standing (Current & Completed) loans increases from a rating of 'AA' to a rating of 'C' but decreases from a rating of 'D' through 'HR' (note that the proportion of Good Standing (Current & Completed) loans within groups actually increases from 'AA' to 'C' but decreases from 'D' to 'HR').
- Almost all the loans assigned a rating of 'HR' had ProsperScore between '1' and '5' but there were some loans assigned ratings of 'C' through 'E' that also had ProsperScore between '8' and '11' (Most of these loans fell into the Good Standing category but a few fell into the Bad Standing category). 
- For ratings of 'B' through 'AA', there were some loans assigned scores '1'-'4', but almost all fell into Good LoanStanding (Current & Completed) category. 
- In terms of ProsperScore and ProsperRating strengthening each other, combinations of very good ProsperScores and very good ProsperRatings (Low ProsperRiskRating) do tend to minimize Bad Standing (Delinquent, Default & Chargedoff) loan statuses but the opposite is not true.
- Combinations of bad ProsperScores and bad ProsperRatings (High ProsperRiskRating) don’t necessarily minimize Good Standing (Current & Completed) status (rather they maximize statuses of Bad Standing).

***

# Reflection {#Reflection}
***

- The Prospser loans dataset contains over 100k observations with 81 variables spanning across 9 years.
- Understanding the variables, terminology and general domain knowledge of financial peer-to-peer lending was the first obstacle in analyzing this dataset.
- The one ongoing hurdle was determining which variables to analyze, not drifting too far off any one path of investigation and not pulling in new variables throughout the process.
- Another persistent issue was overplotting on scatterplots, a number of techniques were used across multiple plots to try to mitigate this issue.

- However, success was found in many areas. The general analysis revealed areas of interests such as correlations between [CreditScore, BorrowerAPR](#CreditScore_BorrowerAPR_plot), [DebtToIncomeRatio](#DebtToIncomeRatio_CreditScore_plot), [IncomeRange](#CreditScore_IncomeRange_Analysis) and [IsBorrowerHomeowner, LoanOriginalAmount](#State_LoanOriginalAmount_IsBorrowerHomeowner) which brought up questions concerning LoanStanding and the perplexity of cause and effect. Also, trends were confirmed and unexpected relationships such as [BorrowerAPR by IncomeRange](#CreditScore_IncomeRange_Analysis) & [LoanOriginalAmount by ProsperRiskRating](#ProsperRiskRating_Analysis) were revealed.

- Some features and relationships which surprised me are
   - I was surprised that BorrowerApr didn’t appear to be strengthened as much by IncomeRange as DebtToIncomeRatio.
   - The number of borrowers with an income of “$100,000+” is very high (more than “$75000-99,999”). This could be because a large number of users with high income consider a peer-to-peer loan.
   - The states of Maine, Iowa & North Dakota do not have any borrowers post July 2009.

-  Having only analyzed 16 of the original 81 variables leaves a lot of undiscovered relationships and trends.
- Additional data would also enhance this dataset. 
   - Having the borrower’s age and sex would allow analysis to possibly discover trends among men & women or young & old. 
   - Also, population and state-average-income features, would allow for discovery of the type of environment the borrower lived in. 
   - For example, a borrower around $75,000 income range living in California could be considered middle class within that state in comparison to a borrower from Iowa in the same income range bracket which might be considered in the upper class.
   - How does your class (lower, middle or upper) determine if you use peer-to-peer loans and/or become a borrower with bad loan standing? This would be dependent on the borrower’s state and the state’s average income range. These types of questions and more could be answered with additional data.

## Potential further steps?
In future analyses, I would like to build models with the dataset, using logistic regression to predict LoanStanding using as many variables as possible.
  
------

